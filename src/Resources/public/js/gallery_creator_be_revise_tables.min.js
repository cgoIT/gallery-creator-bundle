(function($){window.addEvent("domready",function(){new GalleryCreatorBeReviseTables});const GalleryCreatorBeReviseTables=new Class({albumIDS:null,errors:0,intRequestDone:0,messageBox:false,statusBox:false,button:false,checkbox:false,labelCheckbox:false,initialize:function(){let self=this;document.id("main").addClass("gc-revise-database");self.button=document.id("reviseTableBtn");self.checkbox=$$("input[name=reviseDatabase]")[0];self.labelCheckbox=$$("label[for=reviseDatabase]")[0];self.messageBox=new Element("div#messageBox");self.messageBox.addClass("gc_message");self.messageBox.inject($$(".tl_formbody_submit")[0],"before");self.statusBox=new Element("div#statusBox",{class:"gc-check-tables-status-box"});self.statusBox.inject(self.messageBox);self.button.addEventListener("click",function(event){if(self.checkbox.checked){event.preventDefault();self.button.fade(0);self.checkbox.fade(0);self.labelCheckbox.fade(0);self.start()}})},start:function(){this.intRequestDone=null;this.errors=0;this.albumIDS=null;$$("#messageBox > p, #messageBox>.gc-check-tables-status-box > p").each(function(el){el.destroy()});new Element("p",{text:"Please wait a moment..."}).inject(this.statusBox);this.getAlbumIDS()},getAlbumIDS:function(){let self=this;let myRequest=new Request.JSON({url:document.URL+"&isAjaxRequest=true&checkTables=true&getAlbumIDS=true",method:"get",onSuccess:function(responseText){if(!responseText)return;if(responseText["ids"]){self.albumIDS=responseText["ids"];self.reviseTables()}},onError:function(){}});myRequest.send()},reviseTables:function(){let self=this;if(self.albumIDS===null){return}self.albumIDS.each(function(albumId){let myRequest=new Request.JSON({url:document.URL+"&isAjaxRequest=true&checkTables=true&reviseTables=true&albumId="+albumId,method:"get",chain:true,onSuccess:function(responseText){if(!responseText){return}if(responseText.errors.toString()==""){return}let arrError=responseText.errors;arrError.each(function(errorMsg){let error=new Element("p",{class:"tl_error",text:errorMsg});error.inject(self.messageBox);self.errors++})},onComplete:function(){self.intRequestDone++;new Element("p",{text:"Check album with ID "+albumId+"."}).inject(self.statusBox);if(self.intRequestDone==self.albumIDS.length){(function(){new Element("p",{class:"tl_confirm",text:"Revised the gallery creator database tables. "+self.errors.toString()+" error(s) found."}).inject(self.messageBox);self.button.fade(1);self.checkbox.checked=false;self.checkbox.fade(1);self.labelCheckbox.fade(1)}).delay(1e3)}},onError:function(){}});myRequest.send()})}})})(document.id);